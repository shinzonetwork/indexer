name: block
steps:
  - name: filter_raw_fields
    type: filter
    config:
      fields:
        - hash
        - number
        - timestamp
        - parentHash
        - difficulty
        - gasUsed
        - gasLimit
        - nonce
        - miner
        - size
        - stateRoot
        - sha3Uncles
        - transactionsRoot
        - receiptsRoot
        - extraData

  - name: normalize_fields
    type: normalize
    config:
      fields:
        - hash
        - parentHash
        - stateRoot
        - sha3Uncles
        - transactionsRoot
        - receiptsRoot
        - miner
        - extraData
      case: lower

  - name: normalize_numbers
    type: normalize
    config:
      fields:
        - number
        - timestamp
        - difficulty
        - gasUsed
        - gasLimit
        - nonce
        - size
      format: string

  - name: map_fields
    type: enrich
    config:
      fields:
        hash: "hash"
        number: "number"
        timestamp: "timestamp"
        parentHash: "parentHash"
        difficulty: "difficulty"
        gasUsed: "gasUsed"
        gasLimit: "gasLimit"
        nonce: "nonce"
        miner: "miner"
        size: "size"
        stateRootHash: "stateRoot"
        uncleHash: "sha3Uncles"
        transactionRootHash: "transactionsRoot"
        receiptsRootHash: "receiptsRoot"
        extraData: "extraData"

  - name: validate_fields
    type: validate
    config:
      required:
        - hash
        - number
        - time
        - parentHash
        - difficulty
        - gasUsed
        - gasLimit
        - nonce
        - miner
        - size
        - stateRoot
        - sha3Uncles
        - transactionsRoot
        - receiptsRoot
        - extraData

  - name: store_block
    type: enrich
    config:
      query: |
        mutation CreateBlock(
          $hash: String!,
          $number: String!,
          $timestamp: String!,
          $parentHash: String!,
          $difficulty: String!,
          $gasUsed: String!,
          $gasLimit: String!,
          $nonce: String!,
          $miner: String!,
          $size: String!,
          $stateRoot: String!,
          $sha3Uncles: String!,
          $transactionsRoot: String!,
          $receiptsRoot: String!,
          $extraData: String!
        ) {
          create_Block(input: [{
            hash: $hash
            number: $number
            timestamp: $timestamp
            parentHash: $parentHash
            difficulty: $difficulty
            gasUsed: $gasUsed
            gasLimit: $gasLimit
            nonce: $nonce
            miner: $miner
            size: $size
            stateRoot: $stateRoot
            sha3Uncles: $sha3Uncles
            transactionsRoot: $transactionsRoot
            receiptsRoot: $receiptsRoot
            extraData: $extraData
          }]) {
            _docID
            hash
          }
        }
